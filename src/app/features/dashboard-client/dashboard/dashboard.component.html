<div class="dashboard-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Tableau de Bord</h1>
      <p class="page-subtitle">Vue d'ensemble de votre activité d'impression</p>
    </div>
    <div class="header-actions">
      <a routerLink="/dashboard-client/upload-document" class="btn-primary">
        <i class="fas fa-plus"></i>
        Nouvelle commande
      </a>
    </div>
  </div>

  <!-- KPIs Grid -->
  <div class="kpis-grid">
    @for (kpi of kpis(); track kpi.label) {
      <div class="kpi-card" [style.border-left-color]="kpi.color">
        <div class="kpi-icon" [style.background]="kpi.color + '20'" [style.color]="kpi.color">
          <i [class]="'fas ' + kpi.icon"></i>
        </div>
        <div class="kpi-info">
          <div class="kpi-label">{{ kpi.label }}</div>
          <div class="kpi-value">{{ kpi.value }}</div>
          @if (kpi.trend) {
            <div class="kpi-trend" [style.color]="kpi.trendColor">
              <i [class]="'fas ' + kpi.trendIcon"></i>
              {{ kpi.trend }}
            </div>
          }
        </div>
      </div>
    }
  </div>

  <!-- Two Columns Layout -->
  <div class="dashboard-grid">
    <!-- Recent Orders Section -->
    <div class="section-card main-section">
      <div class="section-header">
        <div>
          <h2 class="section-title">
            <i class="fas fa-clock"></i>
            Commandes Récentes
          </h2>
          <p class="section-subtitle">Vos dernières commandes en cours de traitement</p>
        </div>
        <a routerLink="/dashboard-client/commandes" class="btn-link">
          Voir tout
          <i class="fas fa-arrow-right"></i>
        </a>
      </div>

      <div class="orders-container">
        @if (isLoading()) {
          <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>Chargement des commandes...</p>
          </div>
        } @else if (recentOrders().length === 0) {
          <div class="empty-state">
            <i class="fas fa-box-open"></i>
            <h3>Aucune commande récente</h3>
            <p>Créez votre première commande d'impression</p>
            <a routerLink="/dashboard-client/upload-document" class="btn-primary">
              <i class="fas fa-plus"></i>
              Nouvelle commande
            </a>
          </div>
        } @else {
          <div class="orders-list">
            @for (order of recentOrders(); track order.id) {
              <div class="order-item" [class.expanded]="expandedOrderId === order.id">
                <div class="order-summary" (click)="toggleOrderDetails(order.id)">
                  <div class="order-main-info">
                    <div class="order-number">
                      <i class="fas fa-file-alt"></i>
                      {{ order.order_number }}
                    </div>
                    <div class="order-service">
                      <span class="service-name">{{ order.document_type }}</span>
                      <span class="service-details">
                        {{ getPrintFormat(order) }} • {{ order.quantity }} ex. • {{ order.number_of_pages }} p.
                      </span>
                    </div>
                  </div>
                  
                  <div class="order-meta">
                    <div class="order-status" 
                         [style.background]="getStatusInfo(order.status).color + '20'" 
                         [style.color]="getStatusInfo(order.status).color">
                      <i [class]="'fas ' + getStatusInfo(order.status).icon"></i>
                      {{ getStatusInfo(order.status).label }}
                    </div>
                    <div class="order-total">
                      <strong>{{ order.total_price }} FCFA</strong>
                    </div>
                    <div class="expand-icon">
                      <i class="fas" 
                         [class.fa-chevron-down]="expandedOrderId !== order.id" 
                         [class.fa-chevron-up]="expandedOrderId === order.id"></i>
                    </div>
                  </div>
                </div>

                <!-- Order Details (Expandable) -->
                @if (expandedOrderId === order.id) {
                  <div class="order-details">
                    <div class="details-grid">
                      <div class="detail-group">
                        <h4>Informations</h4>
                        <div class="detail-item">
                          <span class="detail-label">Type de document:</span>
                          <span class="detail-value">{{ order.document_type }}</span>
                        </div>
                        <div class="detail-item">
                          <span class="detail-label">Format:</span>
                          <span class="detail-value">{{ getPrintFormat(order) }}</span>
                        </div>
                        <div class="detail-item">
                          <span class="detail-label">Impression:</span>
                          <span class="detail-value">{{ getPrintSides(order) === 'double' ? 'Recto-verso' : 'Recto simple' }}</span>
                        </div>
                        <div class="detail-item">
                          <span class="detail-label">Couleur:</span>
                          <span class="detail-value">{{ getPrintType(order) === 'color' ? 'Couleur' : 'Noir & Blanc' }}</span>
                        </div>
                      </div>

                      <div class="detail-group">
                        <h4>Configuration</h4>
                        <div class="detail-item">
                          <span class="detail-label">Support:</span>
                          <span class="detail-value">{{ getPaperType(order) }}</span>
                        </div>
                        <div class="detail-item">
                          <span class="detail-label">Quantité:</span>
                          <span class="detail-value">{{ order.quantity }} exemplaires</span>
                        </div>
                        <div class="detail-item">
                          <span class="detail-label">Pages par exemplaire:</span>
                          <span class="detail-value">{{ order.number_of_pages }} pages</span>
                        </div>
                        <div class="detail-item">
                          <span class="detail-label">Pages totales:</span>
                          <span class="detail-value">{{ order.number_of_pages * order.quantity }} pages</span>
                        </div>
                        @if (order.note) {
                          <div class="detail-item full-width">
                            <span class="detail-label">Instructions:</span>
                            <span class="detail-value notes">{{ order.note }}</span>
                          </div>
                        }
                      </div>

                      <div class="detail-group">
                        <h4>Livraison & Paiement</h4>
                        <div class="detail-item">
                          <span class="detail-label">Mode de récupération:</span>
                          <span class="detail-value">{{ getDeliveryType(order) === 'delivery' ? 'Livraison à domicile' : 'Retrait en magasin' }}</span>
                        </div>
                        @if (getDeliveryType(order) === 'delivery') {
                          <div class="detail-item">
                            <span class="detail-label">Adresse:</span>
                            <span class="detail-value">
                              {{ order.delivery_address }}, {{ order.delivery_neighborhood }}, {{ order.delivery_city }}
                            </span>
                          </div>
                          @if (order.delivery_phone) {
                            <div class="detail-item">
                              <span class="detail-label">Téléphone:</span>
                              <span class="detail-value">{{ order.delivery_phone }}</span>
                            </div>
                          }
                        }
                        <div class="detail-item">
                          <span class="detail-label">Date de commande:</span>
                          <span class="detail-value">{{ getFormattedDate(order.created_at) }}</span>
                        </div>
                        <div class="detail-item">
                          <span class="detail-label">Estimation livraison:</span>
                          <span class="detail-value">{{ getFormattedDate(getEstimatedDelivery(order.created_at)) }}</span>
                        </div>
                        <div class="detail-item">
                          <span class="detail-label">Priorité:</span>
                          <span class="detail-value">
                            <span [class]="'priority-' + order.priority">
                              {{ order.priority === 'normal' ? 'Normale' : order.priority === 'urgent' ? 'Urgente' : 'Très urgente' }}
                            </span>
                          </span>
                        </div>
                      </div>
                    </div>

                    <div class="order-actions">
                      @if (order.document_url) {
                        <button class="btn-outline" (click)="downloadFiles(order)">
                          <i class="fas fa-download"></i>
                          Télécharger les fichiers
                        </button>
                      }
                      <button class="btn-primary" (click)="contactSupport(order)">
                        <i class="fas fa-headset"></i>
                        Contacter le support
                      </button>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        }
      </div>
    </div>

    <!-- Sidebar Sections -->
    <div class="sidebar-sections">
      <!-- Quick Stats -->
      <div class="section-card stats-card">
        <h3 class="section-title">
          <i class="fas fa-chart-bar"></i>
          Statistiques du mois
        </h3>
        <div class="stats-list">
          <div class="stat-item">
            <div class="stat-value">{{ monthlyStats().totalOrders }}</div>
            <div class="stat-label">Commandes</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ monthlyStats().totalPages | number:'1.0-0' }}</div>
            <div class="stat-label">Pages imprimées</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ monthlyStats().savings | number:'1.0-0' }} FCFA</div>
            <div class="stat-label">Économies</div>
          </div>
        </div>
      </div>

      <!-- Progress Tracking -->
      <div class="section-card progress-card">
        <h3 class="section-title">
          <i class="fas fa-tasks"></i>
          Suivi en temps réel
        </h3>
        <div class="progress-list">
          @for (progress of currentProgress(); track progress.orderNumber) {
            <div class="progress-item">
              <div class="progress-info">
                <div class="progress-order">{{ progress.orderNumber }}</div>
                <div class="progress-service">{{ progress.service }}</div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="progress.percentage"></div>
              </div>
              <div class="progress-percentage">{{ progress.percentage }}%</div>
            </div>
          }
          @if (currentProgress().length === 0 && !isLoading()) {
            <div class="no-progress">
              <i class="fas fa-check-circle"></i>
              <p>Aucune commande en cours</p>
            </div>
          }
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="section-card actions-card">
        <h3 class="section-title">
          <i class="fas fa-bolt"></i>
          Actions Rapides
        </h3>
        <div class="quick-actions-list">
          <a routerLink="/dashboard-client/upload-document" class="quick-action">
            <i class="fas fa-print"></i>
            <span>Nouvelle impression</span>
          </a>
          <a routerLink="/dashboard-client/historique" class="quick-action">
            <i class="fas fa-history"></i>
            <span>Historique complet</span>
          </a>
          <a routerLink="/dashboard-client/discussion" class="quick-action">
            <i class="fas fa-comments"></i>
            <span>Support en ligne</span>
          </a>
          <button class="quick-action" (click)="trackDelivery()">
            <i class="fas fa-truck"></i>
            <span>Suivi livraison</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Promotions Section -->
  <div class="section-card promotions-card">
    <div class="section-header">
      <div>
        <h2 class="section-title">
          <i class="fas fa-tag"></i>
          Promotions en cours
        </h2>
        <p class="section-subtitle">Profitez de nos offres spéciales</p>
      </div>
    </div>
    <div class="promotions-grid">
      @for (promo of currentPromotions(); track promo.id) {
        <div class="promo-card" [style.background]="promo.color + '10'">
          <div class="promo-badge" [style.background]="promo.color">
            {{ promo.discount }}
          </div>
          <div class="promo-content">
            <h4>{{ promo.title }}</h4>
            <p>{{ promo.description }}</p>
            <span class="promo-period">Valable jusqu'au {{ promo.validUntil | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
      }
    </div>
  </div>
</div>