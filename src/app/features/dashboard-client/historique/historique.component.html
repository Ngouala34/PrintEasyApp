<!-- src/app/features/dashboard-client/historique/historique.component.html -->
<div class="historique-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-history"></i>
        Historique des Commandes
      </h1>
      <p class="page-subtitle">Consultez toutes vos commandes passées</p>
    </div>
    <div class="header-stats">
      <div class="stat-badge">
        <i class="fas fa-shopping-bag"></i>
        <span>{{ filteredOrders().length }} commandes</span>
      </div>
      <div class="stat-badge">
        <i class="fas fa-money-bill-wave"></i>
        <span>{{ getTotalSpent() | number:'1.0-0' }} FCFA dépensés</span>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Rechercher par numéro de commande ou service..."
        [value]="searchQuery()"
        (input)="onSearchChange($any($event.target).value)"
        class="search-input">
    </div>

    <div class="filter-group">
      <select 
        [value]="selectedStatus()"
        (change)="onStatusChange($any($event.target).value)"
        class="filter-select">
        <option value="all">Tous les statuts</option>
        <option value="delivered">Livrées</option>
        <option value="cancelled">Annulées</option>
      </select>

      <select 
        [value]="selectedMonth()"
        (change)="onMonthChange($any($event.target).value)"
        class="filter-select">
        <option value="all">Tous les mois</option>
        <option value="0">Janvier</option>
        <option value="1">Février</option>
        <option value="2">Mars</option>
        <option value="3">Avril</option>
        <option value="4">Mai</option>
        <option value="5">Juin</option>
        <option value="6">Juillet</option>
        <option value="7">Août</option>
        <option value="8">Septembre</option>
        <option value="9">Octobre</option>
        <option value="10">Novembre</option>
        <option value="11">Décembre</option>
      </select>
    </div>
  </div>

  <!-- Orders Table -->
  @if (filteredOrders().length > 0) {
    <div class="orders-table-container">
      <table class="orders-table">
        <thead>
          <tr>
            <th>
              <i class="fas fa-hashtag"></i>
              Numéro
            </th>
            <th>
              <i class="fas fa-calendar"></i>
              Date
            </th>
            <th>
              <i class="fas fa-print"></i>
              Service
            </th>
            <th>
              <i class="fas fa-calculator"></i>
              Quantité
            </th>
            <th>
              <i class="fas fa-info-circle"></i>
              Statut
            </th>
            <th>
              <i class="fas fa-money-bill"></i>
              Total
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (order of filteredOrders(); track order.id) {
            <tr>
              <td class="order-number">{{ order.orderNumber }}</td>
              <td>{{ order.date | date:'dd/MM/yyyy' }}</td>
              <td>{{ order.service }}</td>
              <td>{{ order.quantity }}</td>
              <td>
                <span 
                  class="status-badge"
                  [style.background]="getStatusBadge(order.status).color + '20'"
                  [style.color]="getStatusBadge(order.status).color">
                  <i [class]="'fas ' + getStatusBadge(order.status).icon"></i>
                  {{ getStatusBadge(order.status).label }}
                </span>
              </td>
              <td class="order-total">{{ order.total | number:'1.0-0' }} FCFA</td>
              <td>
                <div class="action-buttons">
                  @if (order.invoiceUrl) {
                    <button 
                      class="btn-icon" 
                      title="Télécharger la facture"
                      (click)="downloadInvoice(order)">
                      <i class="fas fa-download"></i>
                    </button>
                  }
                  <button class="btn-icon" title="Voir détails">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="empty-state">
      <i class="fas fa-inbox"></i>
      <h3>Aucune commande trouvée</h3>
      <p>Aucune commande ne correspond à vos critères de recherche</p>
      <button class="btn-primary" (click)="searchQuery.set(''); filterOrders()">
        <i class="fas fa-redo"></i>
        Réinitialiser les filtres
      </button>
    </div>
  }
</div>