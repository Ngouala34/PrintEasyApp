<!-- src/app/features/dashboard-client/historique/historique.component.html -->
<div class="historique-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-history"></i>
        Historique des Commandes
      </h1>
      <p class="page-subtitle">Consultez toutes vos commandes passées</p>
    </div>
    <div class="header-stats">
      <div class="stat-badge">
        <i class="fas fa-shopping-bag"></i>
        <span>{{ filteredOrders().length }} commandes</span>
      </div>
      <div class="stat-badge">
        <i class="fas fa-money-bill-wave"></i>
        <span>{{ getTotalSpent() | number:'1.0-0' }} FCFA économisés</span>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Rechercher par numéro, service ou ville..."
        [value]="searchQuery()"
        (input)="onSearchChange($any($event.target).value)"
        class="search-input">
    </div>

    <div class="filter-group">
      <select 
        [value]="selectedStatus()"
        (change)="onStatusChange($any($event.target).value)"
        class="filter-select">
        <option value="all">Tous les statuts</option>
        <option value="pending">En attente</option>
        <option value="processing">En traitement</option>
        <option value="delivered">Livrées</option>
        <option value="cancelled">Annulées</option>
      </select>

      <select 
        [value]="selectedMonth()"
        (change)="onMonthChange($any($event.target).value)"
        class="filter-select">
        <option value="all">Tous les mois</option>
        <option value="0">Janvier</option>
        <option value="1">Février</option>
        <option value="2">Mars</option>
        <option value="3">Avril</option>
        <option value="4">Mai</option>
        <option value="5">Juin</option>
        <option value="6">Juillet</option>
        <option value="7">Août</option>
        <option value="8">Septembre</option>
        <option value="9">Octobre</option>
        <option value="10">Novembre</option>
        <option value="11">Décembre</option>
      </select>
    </div>
  </div>

  <!-- Orders Table -->
  @if (filteredOrders().length > 0) {
    <div class="orders-table-container">
      <table class="orders-table">
        <thead>
          <tr>
            <th>
              <i class="fas fa-hashtag"></i>
              Numéro
            </th>
            <th>
              <i class="fas fa-calendar"></i>
              Date
            </th>
            <th>
              <i class="fas fa-print"></i>
              Service
            </th>
            <th>
              <i class="fas fa-calculator"></i>
              Quantité
            </th>
            <th>
              <i class="fas fa-file-alt"></i>
              Pages
            </th>
            <th>
              <i class="fas fa-truck"></i>
              Livraison
            </th>
            <th>
              <i class="fas fa-info-circle"></i>
              Statut
            </th>
            <th>
              <i class="fas fa-money-bill"></i>
              Total
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (order of filteredOrders(); track order.id) {
            <tr>
              <td class="order-number">{{ order.orderNumber }}</td>
              <td>{{ order.date | date:'dd/MM/yyyy' }}</td>
              <td>
                <div class="service-info">
                  <strong>{{ order.service }}</strong>
                </div>
              </td>
              <td>{{ order.quantity }}</td>
              <td>{{ order.numberOfPages }} page(s)</td>
              <td class="delivery-info">
                {{ order.deliveryInfo.city }}
              </td>
              <td>
                <span 
                  class="status-badge"
                  [style.background]="getStatusBadge(order.status).color + '20'"
                  [style.color]="getStatusBadge(order.status).color">
                  <i [class]="'fas ' + getStatusBadge(order.status).icon"></i>
                  {{ getStatusBadge(order.status).label  }}
                </span>
              </td>
              <td class="order-total">{{ order.total | number:'1.0-0' }} FCFA</td>
              <td>
                <div class="action-buttons">
                  @if (order.documentUrl) {
                    <button 
                      class="btn-icon" 
                      title="Voir le document"
                      (click)="downloadDocument(order)">
                      <i class="fas fa-eye"></i>
                    </button>
                  }
                  <button 
                    class="btn-icon" 
                    title="Voir détails"
                    (click)="showOrderDetails(order)">
                    <i class="fas fa-info-circle"></i>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="empty-state">
      <i class="fas fa-inbox"></i>
      <h3>Aucune commande trouvée</h3>
      <p>Aucune commande ne correspond à vos critères de recherche</p>
      <button class="btn-primary" (click)="searchQuery.set(''); selectedStatus.set('all'); selectedMonth.set('all'); filterOrders()">
        <i class="fas fa-redo"></i>
        Réinitialiser les filtres
      </button>
    </div>
  }

  <!-- Order Details Modal -->
  @if (selectedOrder()) {
    <div class="modal-overlay" (click)="closeOrderDetails()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Détails de la commande {{ selectedOrder()!.orderNumber }}</h2>
          <button class="btn-close" (click)="closeOrderDetails()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <div class="modal-body">
          <div class="details-grid">
            <!-- Informations générales -->
            <div class="detail-section">
              <h3><i class="fas fa-info-circle"></i> Informations générales</h3>
              <div class="detail-row">
                <span class="detail-label">Date de commande:</span>
                <span class="detail-value">{{ selectedOrder()!.date | date:'dd/MM/yyyy à HH:mm' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Type de document:</span>
                <span class="detail-value">{{ selectedOrder()!.documentType }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Statut:</span>
                <span class="detail-value">
                  <span 
                    class="status-badge"
                    [style.background]="getStatusBadge(selectedOrder()!.status).color + '20'"
                    [style.color]="getStatusBadge(selectedOrder()!.status).color">
                    {{ getStatusBadge(selectedOrder()!.status).label }}
                  </span>
                </span>
              </div>
            </div>

            <!-- Options d'impression -->
            <div class="detail-section">
              <h3><i class="fas fa-cogs"></i> Options d'impression</h3>
              <div class="detail-row">
                <span class="detail-label">Couleur:</span>
                <span class="detail-value">{{ selectedOrder()!.options.option_color }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Format:</span>
                <span class="detail-value">{{ selectedOrder()!.options.option_format }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Papier:</span>
                <span class="detail-value">{{ selectedOrder()!.options.option_paper }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Recto/Verso:</span>
                <span class="detail-value">{{ selectedOrder()!.options.option_sides }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Livraison:</span>
                <span class="detail-value">{{ selectedOrder()!.options.option_delivery }}</span>
              </div>
            </div>

            <!-- Détails techniques -->
            <div class="detail-section">
              <h3><i class="fas fa-file-alt"></i> Détails techniques</h3>
              <div class="detail-row">
                <span class="detail-label">Quantité:</span>
                <span class="detail-value">{{ selectedOrder()!.quantity }} exemplaire(s)</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Nombre de pages:</span>
                <span class="detail-value">{{ selectedOrder()!.numberOfPages }} page(s)</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Prix unitaire:</span>
                <span class="detail-value">{{ selectedOrder()!.unitPrice }} FCFA</span>
              </div>
            </div>

            <!-- Informations de livraison -->
            <div class="detail-section">
              <h3><i class="fas fa-truck"></i> Livraison</h3>
              <div class="detail-row">
                <span class="detail-label">Ville:</span>
                <span class="detail-value">{{ selectedOrder()!.deliveryInfo.city }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Quartier:</span>
                <span class="detail-value">{{ selectedOrder()!.deliveryInfo.neighborhood }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Adresse:</span>
                <span class="detail-value">{{ selectedOrder()!.deliveryInfo.address }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Téléphone:</span>
                <span class="detail-value">{{ selectedOrder()!.deliveryInfo.phone }}</span>
              </div>
            </div>

            <!-- Informations financières -->
            <div class="detail-section">
              <h3><i class="fas fa-money-bill-wave"></i> Informations financières</h3>
              <div class="detail-row">
                <span class="detail-label">Prix unitaire:</span>
                <span class="detail-value">{{ selectedOrder()!.unitPrice }} FCFA</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Quantité:</span>
                <span class="detail-value">{{ selectedOrder()!.quantity }}</span>
              </div>
              <div class="detail-row total-row">
                <span class="detail-label">Total:</span>
                <span class="detail-value total-price">{{ selectedOrder()!.total | number:'1.0-0' }} FCFA</span>
              </div>
            </div>

            <!-- Notes -->
            @if (selectedOrder()!.note) {
              <div class="detail-section">
                <h3><i class="fas fa-sticky-note"></i> Notes</h3>
                <div class="note-content">
                  {{ selectedOrder()!.note }}
                </div>
              </div>
            }

            <!-- Document -->
            @if (selectedOrder()!.documentUrl) {
              <div class="detail-section">
                <h3><i class="fas fa-file-pdf"></i> Document</h3>
                <button class="btn-secondary" (click)="downloadDocument(selectedOrder()!)">
                  <i class="fas fa-download"></i>
                  Télécharger le document
                </button>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>