<!-- src/app/components/commandes/commandes.component.html -->
<div class="commandes-page">
  
  <!-- En-tête -->
  <header class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <i class="fas fa-history"></i>
          Historique des Commandes
        </h1>
        <p class="page-subtitle">Consultez et gérez toutes vos commandes</p>
      </div>
      
      <div class="header-actions">
        <button class="btn-refresh" (click)="onRefresh()" [disabled]="isLoading()" title="Rafraîchir">
          <i class="fas fa-sync-alt" [class.spinning]="isLoading()"></i>
        </button>
        <button class="btn-export" (click)="onExportPDF()" title="Exporter en PDF">
          <i class="fas fa-file-pdf"></i>
          <span>PDF</span>
        </button>
        <button class="btn-export" (click)="onExportCSV()" title="Exporter en CSV">
          <i class="fas fa-file-csv"></i>
          <span>CSV</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Statistiques rapides -->
  <section class="quick-stats" *ngIf="!isLoading()">
    <div class="stat-card">
      <div class="stat-icon stat-icon--total">
        <i class="fas fa-file-alt"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().total }}</div>
        <div class="stat-label">Total</div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon stat-icon--pending">
        <i class="fas fa-clock"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().pending }}</div>
        <div class="stat-label">En attente</div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon stat-icon--progress">
        <i class="fas fa-spinner"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().in_progress }}</div>
        <div class="stat-label">En production</div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon stat-icon--success">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().printed }}</div>
        <div class="stat-label">Imprimées</div>
      </div>
    </div>
    

  </section>

  <!-- Barre de filtres et recherche -->
  <section class="filters-bar">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text"
        class="search-input"
        placeholder="Rechercher par numéro, client, email..."
        [(ngModel)]="searchQuery"
        (ngModelChange)="currentPage.set(1)">
      <button 
        class="btn-clear-search" 
        *ngIf="searchQuery()"
        (click)="searchQuery.set('')"
        title="Effacer">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="filters-group">
      <select 
        class="filter-select"
        [(ngModel)]="selectedStatus"
        (ngModelChange)="currentPage.set(1)">
        <option value="all">Tous les statuts</option>
        <option value="pending">En attente</option>
        <option value="in_progress">En production</option>
        <option value="printed">Imprimé</option>
        <option value="delivered">Livré</option>
        <option value="cancelled">Annulé</option>
      </select>

      <select 
        class="filter-select"
        [(ngModel)]="selectedDocumentType"
        (ngModelChange)="currentPage.set(1)">
        <option value="all">Tous les types</option>
        <option *ngFor="let type of documentTypes()" [value]="type">{{ type }}</option>
      </select>

      <button class="btn-reset-filters" (click)="onResetFilters()" title="Réinitialiser les filtres">
        <i class="fas fa-undo"></i>
        <span>Réinitialiser</span>
      </button>
    </div>
  </section>

  <!-- Loading state -->
  <div class="loading-container" *ngIf="isLoading()">
    <div class="spinner-large"></div>
    <p>Chargement des commandes...</p>
  </div>

  <!-- Error state -->
  <div class="error-container" *ngIf="error() && !isLoading()">
    <i class="fas fa-exclamation-triangle"></i>
    <h3>{{ error() }}</h3>
    <button class="btn-retry" (click)="onRefresh()">
      <i class="fas fa-redo"></i>
      Réessayer
    </button>
  </div>

  <!-- Tableau des commandes -->
  <section class="orders-section" *ngIf="!isLoading() && !error()">
    
    <!-- Info résultats -->
    <div class="results-info">
      <p>
        <strong>{{ filteredOrders().length }}</strong> 
        {{ filteredOrders().length > 1 ? 'commandes trouvées' : 'commande trouvée' }}
      </p>
      <div class="items-per-page">
        <label>Afficher</label>
        <select [(ngModel)]="itemsPerPage" (ngModelChange)="currentPage.set(1)">
          <option [value]="5">5</option>
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
        <label>par page</label>
      </div>
    </div>

    <!-- Tableau -->
    <div class="table-wrapper">
      <table class="orders-table">
        <thead>
          <tr>
            <th (click)="onSort('order_number')" class="sortable">
              Numéro
              <i class="fas" [ngClass]="{
                'fa-sort': sortBy() !== 'order_number',
                'fa-sort-up': sortBy() === 'order_number' && sortDirection() === 'asc',
                'fa-sort-down': sortBy() === 'order_number' && sortDirection() === 'desc'
              }"></i>
            </th>
            <th (click)="onSort('client')" class="sortable">
              Client
              <i class="fas" [ngClass]="{
                'fa-sort': sortBy() !== 'client',
                'fa-sort-up': sortBy() === 'client' && sortDirection() === 'asc',
                'fa-sort-down': sortBy() === 'client' && sortDirection() === 'desc'
              }"></i>
            </th>
            <th>Type</th>
            <th>Quantité</th>
            <th (click)="onSort('total')" class="sortable">
              Total
              <i class="fas" [ngClass]="{
                'fa-sort': sortBy() !== 'total',
                'fa-sort-up': sortBy() === 'total' && sortDirection() === 'asc',
                'fa-sort-down': sortBy() === 'total' && sortDirection() === 'desc'
              }"></i>
            </th>
            <th (click)="onSort('status')" class="sortable">
              Statut
              <i class="fas" [ngClass]="{
                'fa-sort': sortBy() !== 'status',
                'fa-sort-up': sortBy() === 'status' && sortDirection() === 'asc',
                'fa-sort-down': sortBy() === 'status' && sortDirection() === 'desc'
              }"></i>
            </th>
            <th (click)="onSort('date')" class="sortable">
              Date
              <i class="fas" [ngClass]="{
                'fa-sort': sortBy() !== 'date',
                'fa-sort-up': sortBy() === 'date' && sortDirection() === 'asc',
                'fa-sort-down': sortBy() === 'date' && sortDirection() === 'desc'
              }"></i>
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr 
            *ngFor="let order of paginatedOrders(); let i = index"
            class="order-row"
            [style.animation-delay.ms]="i * 50">
            <td class="order-number">
              <span class="order-badge">{{ order.order_number }}</span>
            </td>
            <td class="client-info">
              <div class="client-name">{{ order.user.full_name }}</div>
              <div class="client-email">{{ order.user.email }}</div>
            </td>
            <td class="document-type">
              <span class="type-badge">{{ order.document_type }}</span>
            </td>
            <td class="quantity">{{ order.quantity }}</td>
            <td class="price">{{ formatCurrency(+order.total_price) }}</td>
            <td class="status">
              <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                {{ getStatusLabel(order.status) }}
              </span>
            </td>
            <td class="date">{{ formatDate(order.created_at.toString()) }}</td>
            <td class="actions">
              <button 
                class="btn-action btn-view"
                (click)="onViewDetails(+order.id)"
                title="Voir les détails">
                <i class="fas fa-eye"></i>
              </button>
            </td>
          </tr>

          <!-- Empty state -->
          <tr *ngIf="paginatedOrders().length === 0" class="empty-row">
            <td colspan="8">
              <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Aucune commande trouvée</p>
                <button class="btn-reset" (click)="onResetFilters()">
                  Réinitialiser les filtres
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav class="pagination" *ngIf="totalPages() > 1">
      <button 
        class="pagination-btn"
        [disabled]="currentPage() === 1"
        (click)="onPageChange(currentPage() - 1)">
        <i class="fas fa-chevron-left"></i>
      </button>

      <button 
        *ngFor="let page of pageNumbers"
        class="pagination-btn"
        [class.active]="page === currentPage()"
        [disabled]="page === -1"
        (click)="page !== -1 && onPageChange(page)">
        {{ page === -1 ? '...' : page }}
      </button>

      <button 
        class="pagination-btn"
        [disabled]="currentPage() === totalPages()"
        (click)="onPageChange(currentPage() + 1)">
        <i class="fas fa-chevron-right"></i>
      </button>
    </nav>

  </section>

</div>

<!-- Modal de détails -->
<app-document-detail 
  *ngIf="selectedOrderId"
  [orderId]="selectedOrderId"
  (closeModal)="onCloseDetailModal()"
  (orderUpdated)="onOrderUpdated($event)">
</app-document-detail>